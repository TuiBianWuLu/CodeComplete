# 第十三章 不常见的数据类型

### 1. 结构体

### 2. 指针

### 3. 全局数据

```text
本章节会为你讲述什么时候你可能会在一些场合中使用结构体而不使用类。还会向你描述使用指针的细节，如果你曾经被
使用全局数据有关的问题所困扰，本章也会为你解释如何避免遇到这些麻烦。
```

#### 13.1 结构体
```text
通常情况下，你会希望创建类而非结构体，这样除了能使用结构体提供的公共数据成员外，还能利用类所提供的私密性和功能性。
但是有时候直接操作成块的数据会十分方便，下面列举出一些使用结构体的理由。
```
1. 用结构体来明确数据关系
2. 用结构体简化对数据块的操作
3. 用结构体来简化参数列表
4. 用结构体来减少维护

```text
结构体数据所带来的最大好处体现在那些与title字段没有逻辑关系的代码段里
```

#### 13.2 指针
```text
指针的使用时现代编程语言中总容易出错的领域之一，对指针的运用具有其固有的复杂性，正确使用指针要求你对
所用编译器的内存管理机制有很好的理解。即使你的语言不要求你使用指针，很好的理解指针也会有助于你理解编程语言是如何工作的。丰富的防御式编程实践经验，会给你带来更大的帮助。
```
##### 用来理解指针的范例
```text
从概念上看，每一个指针都包含两个部分：内存中的某处位置，以及如何解释该位置中的内容
```
###### 内存中的位置
```text
内存中的位置就是一个地址，常用16进制形式表示。32位处理器中的一个地址用一个32位的值表示，比如0x0013EA01。
```
###### 如何解释指针所指的内容
```text
如何解释内存中某个位置的内容，是由指针的基类型（base type）决定的。如果某指针指向整数，这就意味着编译器会把该指针
所指向内存位置的数据解释为一个整数。
在理解指针的时候，应该记住内存并不包含任何与之相关联的内在的解释。只有通过使用一个特定类型的指针，一个特殊位置的比特才能解释为有意义的数据。
```

|0A|61|62|63|64|65|66|67|68|69|6A|
|---|---|---|---|---|---|---|---|---|---|---|

解释方式：用于进一步举例的原始内存空间

意义：没有与之关联的指针变量，没有任何意义

##### 使用指针的一般技巧
```text
正确地使用指针要求程序员采用一种双向策略。第一，要首先避免造成指针错误。指针错误很难发现，因此采用一些预防性的措施是值得的。
其次，在编写代码之后尽快地检测出指针错误来。指针错误的症状飘忽不定，采取一些额外措施来使得这些症状可以被预测是非常值得的，下面说明下如何才能实现这些目标。
```
1. 把指针操作限制在子程序或者类里面
2. 同时声明和定义指针
3. 在与指针分配相同的作用域中删除指针
4. 在使用指针之前检查指针
5. 先检查指针所引用的变量再使用它
6. 用狗牌字段来检测损毁的内存
7. 增加明显的冗余
8. 用额外的指针变量来提高代码清晰度
9. 简化复杂的指针表达式
10. 按照正确的顺序删除链表中的指针
11. 分配一片保留的内存后备区域
12. 粉碎垃圾数据
13. 在删除或者释放指针之后把它们设为控制
14. 在删除变量之前检查非法指针
15. 跟踪指针分配情况
16. 编写覆盖子程序，集中实现避免指针问题的策略
17. 采用非指针的技术

#### 13.3 全局数据
```text
全局数据可以在程序中任意一个位置访问。使用全局数据的风险比使用局部数据大。极富经验的程序员还认为通过一些子程序来访问数据很有帮助
不过，即使全局数据并不总是引发错误，也很难将其作为最佳的解决办法。
```

##### 与全局数据有关的常见问题
```text
人们指出了使用全局数据的许多问题，实际上这些问题都可以归结到下面几种情况
```
1. 无意间修改了全局数据
2. 与全局数据有关的奇异和令人激动的别名问题
3. 与全局数据有关的代码重入问题
4. 全局数据阻碍代码重用
5. 与全局数据有关的非确定的初始化顺序事宜
6. 全局数据破快了模块化和智力上的可管理性

##### 使用全局数据的理由
1. 保存全局数值
2. 模拟具名常量
3. 模拟枚举类型
4. 简化对其常用的数据的使用
5. 消除流浪数据

##### 只有万不得已时才使用全局数据
在你选择使用全局数据之前，请考虑下面替代方案
1. 首先把一个变量设为局部的，仅当需要时才把变量设置成全局的
2. 区分全局变量和累变量
3. 使用访问器子程序

##### 用访问器子程序来取代全局数据
```text
你用全局数据做的任何事情，都可以用访问器子程序做的更好。使用访问器子程序是实现抽象数据类型和信息隐藏的一种核心方法。
即使你不希望使用装备齐全的抽象数据类型，你仍然可以用访问器子程序来集中控制你的数据，并保护你免受变化的困扰。
```

###### 访问器子程序的优势
1. 你获得了对数据的集中控制
2. 你可以确保对变量的所有引用都得到了保护
3. 你可以自动获得信息隐藏的普遍益处
4. 访问器子程序可以很容易的转变为抽象数据类型

###### 如何使用访问器子程序
1. 要求所有的代码通过访问器子程序来读取数据
2. 不要把你所有的全局数据都扔在一处
3. 用锁定来控制对全局变量的访问
4. 在你的访问器子程序里构造一个抽象层
5. 使得对一项数据的所有访问都发生在同一抽象层上

##### 如何降低使用全局数据的风险
1. 创建一种命名规则来突出全局变量
2. 为全部的全局变量创建一份注释良好的清单
3. 不要用全局变量来存放中间结果
4. 不要把所有的数据都放在一个大对象中并到处传递，以说明你没有使用全局变量


#### 总结
1. 结构体可以使程序更简单、更容易理解、更容易维护
2. 当你打算使用结构体的时候，考虑采用类是不是会工作的更好
3. 指针很容易出错，用访问器子程序或类以及防御式编程实践来保护自己的代码
4. 避免全局变量，不只是因为他们很危险，还是因为你可以用其他更好的方法来取代它们
5. 如果你不得不使用全局变量，纳闷通过访问器子程序来使用它。访问器子程序能为你带来全局变量所能带来的一切优点，还有一些额外好处